version: '3'

services:

  ### Gateway ###
  gateway-service:
    build:
      context: gateway
    ports:
      - "8001:8080"
      - "7001:5005"
    networks:
      - sally-gateway-network
  ######

  ### User Service ###
  user-service:
    build:
      context: user-service
    ports:
    - "7002:5005" # for debug
    environment:
      SPRING_PROFILES_ACTIVE: dev
    depends_on:
      - user-service-postgres
    networks:
      - sally-user-service-network
      - sally-gateway-network
    command: java -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005 -jar ./user-service.jar

  user-service-postgres:
    image: postgres:12.0-alpine
    environment:
      POSTGRES_DB: user-service-db
      POSTGRES_USER: user-service
      POSTGRES_PASSWORD: root
    networks:
      - sally-user-service-network
  ######

  ### Shop Service ###
  shop-service:
    build:
      context: shop-service
    ports:
    - "7003:5005"
    environment:
      SPRING_PROFILES_ACTIVE: dev
    depends_on:
      - shop-service-postgres
    networks:
      - sally-gateway-network
      - sally-shop-service-network
    command: java -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005 -jar ./shop-service.jar

  shop-service-postgres:
    image: postgres:12.0-alpine
    environment:
      POSTGRES_DB: shop-service-db
      POSTGRES_USER: shop-service
      POSTGRES_PASSWORD: root
    networks:
      - sally-shop-service-network
  #######


networks:
  sally-gateway-network:
  sally-user-service-network:
  sally-shop-service-network: